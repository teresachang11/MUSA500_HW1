---
title: "MUSA500 - HW1"
author: "Chenxi Zhu, Teresa Chang, and Tiffany Luo "
date: "Octobor 1,2023"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---
## 1. Introduction
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, warning = FALSE}
options(scipen=10000000)

library(tidyverse)
library(kableExtra)
library(caret)
library(knitr) 
library(pscl)
library(plotROC)
library(pROC)
library(lubridate)
library(scales)
library(stargazer)
library(cowplot)
library(ggpubr)

```

## 2. Methods
### 2.1 Data Cleaning
### 2.2 Exploratory Data Analysis
### 2.3 Multiple Regression Analysis
### 2.4 Additional Analyses
### 2.5 Software

## 3. Results
### 3.1 Exploratory Results   
### 3.2 Regression Results
### 3.3 Regression Assumption Checks
### 3.4 Additional Models
```{r}
#Teresa's path (does someone know how to use relative path in R lol?)
data <- read.csv("/Users/teresachang/Downloads/RegressionData.csv")
```

```{r}
MedHouseValue = c('Median House Value', mean(data$MEDHVAL), sd(data$MEDHVAL))
HH_poverty = c('# Households Living in Poverty', mean(data$NBELPOV100), sd(data$NBELPOV100))
bachelor = c('% of Individuals with Bachelorâ€™s Degrees or Higher', mean(data$PCTBACHMOR), sd(data$PCTBACHMOR))
vacant = c('% of Vacant Houses', mean(data$PCTVACANT), sd(data$PCTVACANT))
SingleHouse = c('% of Single House Units', mean(data$PCTSINGLES), sd(data$PCTSINGLES))

table = as.data.frame(t(data.frame(
              MedHouseValue,
              HH_poverty,
              bachelor,
              vacant,
              SingleHouse
              )))

colnames(table) = c("Variable", "Mean", "SD")

table
```

```{r}
MedHV = ggplot(data) +
        geom_histogram(aes(MEDHVAL))
HHpov = ggplot(data) +
        geom_histogram(aes(NBELPOV100))
bach = ggplot(data) +
        geom_histogram(aes(PCTBACHMOR))
vacant = ggplot(data) +
        geom_histogram(aes(PCTVACANT))
SingleH = ggplot(data) +
        geom_histogram(aes(PCTSINGLES))

MedHV
HHpov
bach
vacant
SingleH

```

```{r}
data$LNMEDHVAL <- log(data$MEDHVAL)
data$LNPCBACHMORE <- log(1+data$PCTBACHMOR)
data$LNNBELPOV100 <- log(data$NBELPOV100)
data$LNPCTVACANT <- log(1+data$PCTVACANT)
data$LNPCTSINGLES <- log(1+data$PCTSINGLES)

```

(from the instruction:
c.	Note that the dependent variable does look more or less normal after the transformation 
- LNMEDHVAL will be used as the dependent variable in the regression analysis. 
- for the predictors, the logarithmic transformation only helps normalize the NBELPOV100 variable 
- so we will use LNNBELPOV100 in the subsequent analyses 

- The other variables have a large spike at zero after the transformations
- we will use the original, untransformed PCBACHMORE, PCTVACANT, and PCTSINGLES variables in the regression

```{r}
LNMedHV = ggplot(data) +
        geom_histogram(aes(LNMEDHVAL))
LNHHpov = ggplot(data) +
        geom_histogram(aes(LNNBELPOV100))
LNbach = ggplot(data) +
        geom_histogram(aes(LNPCBACHMORE))
LNvacant = ggplot(data) +
        geom_histogram(aes(LNPCTVACANT))
LNSingleH = ggplot(data) +
        geom_histogram(aes(LNPCTSINGLES))

LNMedHV
LNHHpov
LNbach
LNvacant
LNSingleH

```

b.	Look at whether the relationship between the dependent variable and each of the predictors is linear.
present all four scatter plots as a single figure.

```{r}
# create a new plotting window and set the plotting area into a 2*2 array
par(mfrow = c(2, 2))

plot(data$LNMEDHVAL, data$LNNBELPOV100)
plot(data$LNMEDHVAL, data$PCTBACHMOR)
plot(data$LNMEDHVAL, data$PCTVACANT)
plot(data$LNMEDHVAL, data$PCTSINGLES)


```

```{r}

cor(data$LNMEDHVAL, data$LNNBELPOV100, method = c("pearson"), use = "complete.obs")
cor(data$LNMEDHVAL, data$PCTBACHMOR, method = c("pearson"), use = "complete.obs")
cor(data$LNMEDHVAL, data$PCTVACANT, method = c("pearson"), use = "complete.obs")
cor(data$LNMEDHVAL, data$PCTSINGLES, method = c("pearson"), use = "complete.obs")

```
```{r}

A <- ggscatter(data, x = "LNMEDHVAL", y = "LNNBELPOV100", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "LNMEDHVAL", ylab = "LNNBELPOV100")

B <- ggscatter(data, x = "LNMEDHVAL", y = "PCTBACHMOR", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "LNMEDHVAL", ylab = "PCTBACHMOR")


C <- ggscatter(data, x = "LNMEDHVAL", y = "PCTVACANT", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "LNMEDHVAL", ylab = "PCTVACANT")

D <- ggscatter(data, x = "LNMEDHVAL", y = "PCTSINGLES", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "LNMEDHVAL", ylab = "PCTSINGLES")

ggarrange(A, B, C, D + rremove("x.text"),  heights = c(10, 10),
          labels = c("A", "B", "C", "D"),
          ncol = 2, nrow = 2)
```

```{r}
data %>% 
  filter_if(~is.numeric(.), all_vars(!is.infinite(.)))


cormatrix <- data[, c(4,6,7,11)]
res <- cor(cormatrix)
round(res, 2)
```


```{r}

library(corrplot)
corrplot(res, type = "upper", 
         tl.col = "black", tl.srt = 45)
```

## 4. Discussion and Limitations